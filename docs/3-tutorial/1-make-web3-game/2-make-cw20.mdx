---
sidebar_position: 2
---

# 게임 토큰(CW20) 발행

import Details from '@theme/Details';
import Ex04 from "@site/src/components/Sandpack/Ex04-make-cw20";
import VaultImgCard from "@site/src/components/VaultImgCard";
import BrowserWindow from '@site/src/components/BrowserWindow';

CW20을 이용하면 게임 생태계와 XPLA 블록체인을 더 쉽게 연결할 수 있습니다. 직접 CW20을 통해 게임 토큰을 발행해봅시다.

<Details summary="CW20이란 무엇인가요?">

XPLA 블록체인은 스마트 컨트랙트 플랫폼인 `Cosmwasm`을 이용합니다. 이더리움의 ERC20처럼, **CW20**은 `Cosmwasm`에서 대체 가능한 토큰(Fungible tokens)에 대한 표준입니다. 더 자세히 알고 싶다면 [공식 문서](https://docs.rs/crate/cw20/0.2.3)를 참고해보세요.

</Details>


## Preview {#preview}

Javascript로 CW20을 발행하는 코드는 아래와 같습니다. 여러분의 니모닉 단어를 넣어 코드를 수정하고 실행해보세요. 조금만 기다리시면 우측에서 실행 결과를 볼 수 있습니다.

<Ex04 />

<br/>

Preview Code를 이해하셨다면, [아래 내용](/docs/tutorial/make-web3-game/make-cw20#runjs)을 읽지 않고 바로 [다음 단계](/docs/tutorial/make-web3-game/implement-in-game)로 넘어가셔도 좋습니다.

## Javascript로 CW20 발행하기 {#runjs}

CW20 컨트랙트를 생성하여 CW20 토큰을 발행해봅시다. CW20 컨트랙트의 Code ID는 메인넷과 테스트넷 모두 `1`입니다.

<Details summary="Code ID란 무엇인가요?">

EVM과 달리, Cosmwasm에서는 코드 배포(Code Deploy)와 컨트랙트 생성이 한번에 이뤄지지 않습니다. 먼저 코드를 블록체인에 배포(StoreCode)하면 해당 코드의 `Code ID`를 발급 받습니다. 이후 `Code ID`를 기반으로 컨트랙트를 생성(InstantiateContract)할 수 있습니다.

똑같은 Code ID로 생성된 컨트랙트들은 모두 같은 코드 기반입니다. 다만 컨트랙트를 생성할 때 입력하는 초깃값(init_msg)이 다르면, 컨트랙트의 세부 사항도 달라집니다. 더 자세한 사항은 [XPLA Docs](https://docs.xpla.io/docs/develop/core-modules/wasm/#code-id)를 참고해보세요.

</Details>

### 코드 실행 {#runcode}

1. example-4.js 파일을 생성해주세요.

2. 아래 코드를 복사하여 example-4.js 파일에 붙여넣고 저장합니다.

    ```js
    const { LCDClient, MnemonicKey, MsgInstantiateContract, Fee, SignMode } = require("@xpla/xpla.js");

    const lcd = new LCDClient({
        chainID: 'cube_47-5',
        URL: 'https://cube-lcd.xpla.dev'
    });

    const main = async () => {
        const mk = new MnemonicKey({
            mnemonic: 'myth snow ski simple century dad gun dolphin sail lawsuit fringe image toast betray frown keep harbor flash table prevent isolate panic tag vehicle' // 여러분의 니모닉 단어로 바꿔주세요.
        })

        const wallet = lcd.wallet(mk);
        const myWalletAddress = wallet.key.accAddress;

        const init_msg = {
            name: "MCT", // My Cw20 Token
            symbol: "MCT", // My Cw20 Token
            decimals: 6,
            initial_balances: [{ address: myWalletAddress, amount: "2000000000000000" }], // 초기 물량을 보유하고 있을 주소들을 배열로 지정합니다.
            mint: { // 추가로 mint가 필요한 경우를 대비해 minter도 지정할수 있지만 옵션입니다.
                minter: myWalletAddress
            }
        };

        const instantiate = new MsgInstantiateContract(
            myWalletAddress, // sender
            myWalletAddress, // admin
            1, // MAINNET, TESTNET CW20 code id
            init_msg,
            {}, // 컨트랙트에 전송할 XPLA 토큰 수량, 현재는 필요하지 않으니 비워둠.
            'Input your label', // 작성하고 싶은 라벨을 입력해주세요.
        );

        const signedTx = await lcd.wallet(mk).createAndSignTx({ // 트랜잭션 생성 및 사이닝, 트랜잭션 fee 설정
            msgs: [instantiate]
        });

        // createAndSignTx 함수를 분리하여 직접 작성하면 아래와 같습니다.
        // const accInfo = await lcd.auth.accountInfo(myWalletAddress) // 지갑 정보 받아오기
        // const acc = accInfo;
        
        // const userSignOption = { // 서명 정보 
        // 	chainID: 'cube_47-5',
        // 	accountNumber: acc.account_number,
        // 	sequence: acc.sequence,
        // 	signMode: SignMode.SIGN_MODE_LEGACY_AMINO_JSON
        // }
        
        // const fee = new Fee(3000000, "2550000000000000000axpla") // 수수료 금액 설정
        
        // const tx = await lcd.tx.create([], { msgs: [instantiate], fee }) // 트랜잭션 생성
        
        // const signedTx = await wallet.key.signTx(tx, userSignOption) // 서명

        const txResult = await lcd.tx.broadcastSync(signedTx);
        console.log(txResult.txhash);
    }
    main()
    ```

3. 10번째 줄의 니모닉 단어들을 여러분의 니모닉 단어로 수정해주세요.

4. VSCode Terminal에서 아래 명령어를 입력합니다.

  ```bash
  node example-4.js
  ```

5. Terminal에서 결과를 확인합니다. CW20 컨트랙트가 생성되고, 생성 트랜잭션의 해시값을 확인할 수 있을 것입니다.

## 설명 {#explaination}

우리는 CW20에 관한 컨트랙트 코드를 작성하지 않았습니다. 코드는 이미 XPLA 블록체인에 배포되었고, 단지 배포된 코드로 컨트랙트를 생성했을 뿐입니다.

먼저 니모닉 단어로 지갑을 불러왔습니다. 여러분은 다른 니모닉 단어를 이용하여 여러분의 지갑을 불러오셨을 것입니다.

```js
const mk = new MnemonicKey({
    mnemonic: 'myth snow ski simple century dad gun dolphin sail lawsuit fringe image toast betray frown keep harbor flash table prevent isolate panic tag vehicle',
})

const wallet = lcd.wallet(mk);
const myWalletAddress = wallet.key.accAddress;
```

<br/>

CW20 컨트랙트 생성을 위해 초기값을 미리 지정해줬습니다. 아래 값들은 수정하셔서, 여러분만의 토큰을 만들어 보시는 것도 좋습니다.

```js
const init_msg = {
    name: "MCT", // My Cw20 Token
    symbol: "MCT", // My Cw20 Token
    decimals: 6,
    initial_balances: [{ address: myWalletAddress, amount: "2000000000000000" }], // 초기 물량을 보유하고 있을 주소들을 배열로 지정합니다.
    mint: { // 추가로 mint가 필요한 경우를 대비해 minter도 지정할수 있지만 옵션입니다.
        minter: myWalletAddress
    }
};
```

<br/>

누가 컨트랙트를 생성하는지(sender), 컨트랙트의 주인은 누구인지(admin), Code ID, 초깃값, 라벨 등을 입력하여 컨트랙트 생성을 준비합니다.

```js
const instantiate = new MsgInstantiateContract(
    myWalletAddress, // sender
    myWalletAddress, // admin
    1, // MAINNET, TESTNET CW20 code id
    init_msg,
    {}, // 컨트랙트에 전송할 XPLA 토큰 수량, 현재는 필요하지 않으니 비워둠.
    'Input your label', // 작성하고 싶은 라벨을 입력해주세요.
);
```

<br/>

`createAndSignTx` 함수를 이용하여 트랜잭션을 생성하고, 서명까지 진행합니다. 

```js
const signedTx = await lcd.wallet(mk).createAndSignTx({ // 트랜잭션 생성 및 사이닝, 트랜잭션 fee 설정
    msgs: [instantiate]
});
```

:::tip

`createAndSignTx` 함수는 트랜잭션을 생성하고, 수수료 금액을 자동으로 설정해주고, 서명도 진행합니다. 이를 각각 분리하여 아래와 같이 직접 할 수도 있습니다.

```js
const accInfo = await lcd.auth.accountInfo(myWalletAddress) // 지갑 정보 받아오기
const acc = accInfo;

const userSignOption = { // 서명 정보 
    chainID: 'cube_47-5',
    accountNumber: acc.account_number,
    sequence: acc.sequence,
    signMode: SignMode.SIGN_MODE_LEGACY_AMINO_JSON
}

const fee = new Fee(3000000, "2550000000000000000axpla") // 수수료 금액 설정

const tx = await lcd.tx.create([], { msgs: [instantiate], fee }) // 트랜잭션 생성

const signedTx = await wallet.key.signTx(tx, userSignOption) // 서명
```

:::

<br/>

`broadcastSync` 함수를 이용하여 생성한 트랜잭션을 네트워크에 송신합니다. 트랜잭션이 XPLA 블록체인에 잘 생성되었다면, 트랜잭션 해시값을 결과로 확인할 수 있을 것입니다.

```js
const txResult = await lcd.tx.broadcastSync(signedTx);
console.log(txResult.txhash);
```

<br/>

생성한 트랜잭션 정보를 아래 코드로 확인해보세요.

1. query-tx.js 파일을 생성합니다.

2. 아래 코드를 복사합니다. `ECDBC35B66384DEE25987AA0DDAE8CF946D1F4907B04A0E77939988474013353` 대신 위에서 생성한 트랜잭션 해시값을 넣어주세요.

```js
const { LCDClient } = require("@xpla/xpla.js");

const lcd = new LCDClient({
	chainID: 'cube_47-5',
	URL: 'https://cube-lcd.xpla.dev'
});

async function main() {
	const txInfo = await lcd.tx.txInfo("ECDBC35B66384DEE25987AA0DDAE8CF946D1F4907B04A0E77939988474013353"); // 트랜잭션 데이터
	console.log(JSON.stringify(txInfo, null, 2));
}
main()
```

3. Terminal에서 아래 명령어를 실행합니다.

```bash
node query-tx.js
```

4. 트랜잭션 정보를 확인합니다.

<br />

혹은 [XPLA Explorer](https://explorer.xpla.io/)를 이용하여 트랜잭션 데이터를 확인하는 것도 좋은 방법입니다.

## 마무리

이렇게 우리는 CW20 토큰을 발행해보았습니다. 토큰을 이용하면 게임 생태계를 더욱 알차게 구성할 수 있겠습니다. [다음 단계](/docs/tutorial/make-web3-game/implement-in-game)에서는 토큰을 전송해보고, 게임 내에서 토큰을 획득하는 기능을 구현해보겠습니다.

