---
sidebar_position: 3
---

# 게임 토큰(CW20) 전송

import Details from '@theme/Details';
import Ex05 from "@site/src/components/Sandpack/Ex05-send-cw20";

게임 플레이 보상으로 유저들에게 CW20을 나눠주어야 할 때가 있습니다. 이번 단계에서는 CW20 전송을 알아봅시다.

## Preview {#preview}

Javascript로 CW20을 전송하는 코드는 아래와 같습니다. [이전 단계](/docs/tutorial/make-web3-game/make-cw20)에서 발행한 컨트랙트의 주소를 `cw20_contract` 변수에 대입해주세요. 이후 여러분의 니모닉 단어를 넣어 코드를 수정하고 실행해보세요. 조금만 기다리시면 우측에서 실행 결과를 볼 수 있습니다.

<Details summary="생성한 컨트랙트의 주소는 어디서 확인하나요?">

가장 쉬운 방법은 [XPLA Explorer](https://explorer.xpla.io/)를 이용하는 것입니다. 실행 결과로 나온 트랜잭션 해시값을 [XPLA Explorer](https://explorer.xpla.io/)에서 검색해봅시다. 이후 Transaction Details 화면에서 `Event Logs` 탭에 들어가시면, 생성된 컨트랙트의 주소를 확인할 수 있습니다. 예제 컨트랙트 주소는 [이곳](https://explorer.xpla.dev/testnet/tx/4BC262846BFA9F845480EF1447503B3F1927CCD4E08DFB82BA91C952BAC1825E#EventLogs)에서 확인할 수 있었습니다.

</Details>

<Ex05 />

<br/>

Preview Code를 이해하셨다면, [아래 내용](/docs/tutorial/make-web3-game/send-cw20#runjs)을 읽지 않고 바로 [다음 단계](/docs/tutorial/add-func-to-game-1/overview)로 넘어가셔도 좋습니다.

## Javascript로 CW20 전송하기 {#runjs}

앞서 발행한 CW20 토큰을 전송해봅시다. 토큰 전송은 CW20 컨트랙트의 `transfer`를 실행(**Execute**)하여 이뤄집니다.

### 코드 실행 {#runcode}

1. example-5.js 파일을 생성해주세요.

2. 아래 코드를 복사하여 example-5.js 파일에 붙여넣고 저장합니다.

    ```js
    const { LCDClient,  MnemonicKey, MsgExecuteContract, TxAPI, Fee } = require("@xpla/xpla.js");

    const lcd = new LCDClient({
        chainID: 'cube_47-5',
        URL: 'https://cube-lcd.xpla.dev'
    });

    const main = async () => {
        const mk = new MnemonicKey({
        mnemonic: 'myth snow ski simple century dad gun dolphin sail lawsuit fringe image toast betray frown keep harbor flash table prevent isolate panic tag vehicle'
        })

        const wallet = lcd.wallet(mk);
        const myWalletAddress = wallet.key.accAddress;
        
        const cw20_contract = "xpla1xljvdrtyn86kv7hrdhae4qxdy8krajah3w7xhtyrt0n69und9xdqdhrasc"; // example-4.js에서 생성한 cw20 토큰의 주소로 교체합니다.
        const recipient = "xpla1cwduqw0z8y66mnfpev2mvrzzzu98tuexepmwrk";

        const transferMsg = new MsgExecuteContract(
            myWalletAddress,
            cw20_contract,
            {
                transfer: {
                    recipient,
                    amount: "100000"
                }
            }
        );
        
        const signedTx = await lcd.wallet(mk).createAndSignTx({ // 트랜잭션 생성 및 사이닝, 트랜잭션 fee 설정
            msgs: [transferMsg]
        });

        // const accInfo = await lcd.auth.accountInfo(myWalletAddress)
        // const acc = accInfo;
        
        // // 메세지에 대한 예상 트랜잭션 fee를 알아낸다.
        // const tx_api = new TxAPI(lcd)
        // const simul_fee = await tx_api.estimateFee(
        // 	[{
        //     sequenceNumber: acc.sequence,
        //     publicKey: mk.publicKey
        // }],
        // 	{
        // 		msgs: [transferMsg],
        // 		gasAdjustment: 1.25,			
        // 	}
        // )
            
        // const fee = new Fee(simul_fee.gas_limit, simul_fee.amount.toString());
        
        // const signedTx = await wallet.createAndSignTx({
        //   msgs: [transferMsg], fee
        // });

        const txResult = await lcd.tx.broadcastSync(signedTx);
        console.log(txResult.txhash);
    }

    main()
    ```

3. 10번째 줄의 니모닉 단어들을 여러분의 니모닉 단어로 수정해주세요.

4. VSCode Terminal에서 아래 명령어를 입력합니다.

  ```bash
  node example-5.js
  ```

5. Terminal에서 결과를 확인합니다. CW20 토큰이 전송되고, 트랜잭션의 해시값을 확인할 수 있을 것입니다.

## 설명 {#explaination}

CW20 전송은 XPLA 전송과는 방식이 다릅니다. XPLA 코인 전송은 `MsgSend` 메소드를 이용했지만, CW20 토큰 전송은 컨트랙트를 실행으로 이뤄지기 때문에 `MsgExecuteContract` 메소드를 이용합니다.

먼저 니모닉 단어로 지갑을 불러왔습니다. 여러분은 다른 니모닉 단어를 이용하여 여러분의 지갑을 불러오셨을 것입니다.

```js
const mk = new MnemonicKey({
    mnemonic: 'myth snow ski simple century dad gun dolphin sail lawsuit fringe image toast betray frown keep harbor flash table prevent isolate panic tag vehicle',
})

const wallet = lcd.wallet(mk);
const myWalletAddress = wallet.key.accAddress;
```

<br/>

[이전 단계](/docs/tutorial/make-web3-game/make-cw20)에서 발행한 컨트랙트의 주소를 `cw20_contract` 변수에 대입해주세요. 예제에서 `xpla1xljvdrtyn86kv7hrdhae4qxdy8krajah3w7xhtyrt0n69und9xdqdhrasc`를 여러분의 컨트랙트 주소로 대체하시면 됩니다.

<Details summary="생성한 컨트랙트의 주소는 어디서 확인하나요?">

가장 쉬운 방법은 [XPLA Explorer](https://explorer.xpla.io/)를 이용하는 것입니다. 실행 결과로 나온 트랜잭션 해시값을 [XPLA Explorer](https://explorer.xpla.io/)에서 검색해봅시다. 이후 Transaction Details 화면에서 `Event Logs` 탭에 들어가시면, 생성된 컨트랙트의 주소를 확인할 수 있습니다. 예제 컨트랙트 주소는 [이곳](https://explorer.xpla.dev/testnet/tx/4BC262846BFA9F845480EF1447503B3F1927CCD4E08DFB82BA91C952BAC1825E#EventLogs)에서 확인할 수 있었습니다.

</Details>

CW20 토큰을 받게 될 지갑 주소를 `recipient` 변수에 대입해주세요. 예제에서 `xpla1cwduqw0z8y66mnfpev2mvrzzzu98tuexepmwrk`를 받게 될 지갑 주소로 대체하시면 됩니다.

:::tip

토큰을 받게 될 지갑이 없으신가요? Vault를 이용해 지갑을 하나 더 만들어 사용하시거나, 아니면 보내는 지갑 주소를 그대로 받는 지갑 주소에 적어도 됩니다. 자기 자신에게 토큰을 전송하는 것이죠.

:::

```js
const cw20_contract = "xpla1xljvdrtyn86kv7hrdhae4qxdy8krajah3w7xhtyrt0n69und9xdqdhrasc"; // example-4.js에서 생성한 cw20 토큰의 주소로 교체합니다.
const recipient = "xpla1cwduqw0z8y66mnfpev2mvrzzzu98tuexepmwrk";
```

<br/>

실행할 컨트랙트 주소, 컨트랙트에서 사용할 함수, 함수의 매개변수값을 입력하여 컨트랙트 실행을 준비합니다.

CW20을 얼만큼 보낼지도 지정할 수 있습니다. `amount` 항목에 수량을 지정하는데, 단위는 uCW20입니다. [이전 단계](/docs/tutorial/make-web3-game/make-cw20#runjs)에서 컨트랙트를 생성할 때, `decimal` 항목이 **6**이었다는 점을 생각해봅시다. **uCW20**이 100000개라면, **CW20** 0.1개를 전송하겠군요.

```js
const transferMsg = new MsgExecuteContract(
    myWalletAddress,
    cw20_contract,
    {
        transfer: {
            recipient,
            amount: "100000"
        }
    }
);
```

<br/>

`createAndSignTx` 함수를 이용하여 트랜잭션을 생성하고, 서명까지 진행합니다. 

```js
const signedTx = await lcd.wallet(mk).createAndSignTx({ // 트랜잭션 생성 및 사이닝, 트랜잭션 fee 설정
    msgs: [transferMsg]
});
```

:::info

`createAndSignTx` 함수는 트랜잭션을 생성하고, 수수료 금액을 자동으로 설정해주고, 서명도 진행합니다. [이전 단계](/docs/tutorial/make-web3-game/make-cw20#runjs)에서 이를 각각 분리한 코드도 함께 보여드렸습니다.

이번엔 트랜잭션 수수료를 추정해주는 `estimateFee` 함수를 이용해서 트랜잭션을 만드는 코드를 살펴보겠습니다. 마찬가지로 `createAndSignTx` 함수 대신 아래 코드로 대체하여 실행해보세요.

```js
const accInfo = await lcd.auth.accountInfo(myWalletAddress)
const acc = accInfo;

// 메세지에 대한 예상 트랜잭션 fee를 알아낸다.
const tx_api = new TxAPI(lcd)
const simul_fee = await tx_api.estimateFee(
    [{
    sequenceNumber: acc.sequence,
    publicKey: mk.publicKey
}],
    {
        msgs: [transferMsg],
        gasAdjustment: 1.25,			
    }
)
    
const fee = new Fee(simul_fee.gas_limit, simul_fee.amount.toString());

const signedTx = await wallet.createAndSignTx({
    msgs: [transferMsg], fee
});
```

:::

<br/>

`broadcastSync` 함수를 이용하여 생성한 트랜잭션을 네트워크에 송신합니다. 트랜잭션이 XPLA 블록체인에 잘 생성되었다면, 트랜잭션 해시값을 결과로 확인할 수 있을 것입니다.

```js
const txResult = await lcd.tx.broadcastSync(signedTx);
console.log(txResult.txhash);
```

<br />

트랜잭션 해시값이 잘 나왔나요? [XPLA Explorer](https://explorer.xpla.io/)를 이용하여 트랜잭션 데이터를 확인해보세요.

## 마무리

이렇게 CW20 토큰 전송까지 알아보았습니다. 이제 여러분의 게임에 CW20 토큰을 이용하여 XPLA 블록체인과 연결해보세요!